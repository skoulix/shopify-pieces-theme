import{P as r}from"./pieces-Piece.js";import{g as i,t as o,r as n}from"./pieces-app.js";class a extends r{constructor(){super("Header",{stylesheets:[]}),this.isScrolled=!1,this.lastScrollY=0,this.scrollThreshold=100,this.hideOnScroll=!1,this.breakpoint="tablet"}mount(){this.$header=this,this.$menuToggle=this.$("[data-menu-toggle]")[0],this.$menuDrawer=this.$("[data-menu-drawer]")[0],this.$menuOverlay=this.$("[data-menu-overlay]")[0],this.$submenus=this.$$("details.has-submenu"),this.breakpoint=this.dataset.breakpoint||"tablet",this.$menuToggle&&this.on("click",this.$menuToggle,this.toggleMenu),this.$menuOverlay&&this.on("click",this.$menuOverlay,this.closeMenu),this.$submenus.forEach(e=>{const s=e.querySelector("summary");s&&this.on("click",s,this.handleSubmenuClick)}),this.$$("[data-menu-close]").forEach(e=>{this.on("click",e,this.handleCloseClick)}),this.on("scroll",window,this.handleScroll),this.on("keyup",this,this.handleKeyUp),this.on("focusout",this,this.handleFocusOut),this.handleScroll(),this.animateIn()}unmount(){this.off("scroll",window,this.handleScroll),this.off("keyup",this,this.handleKeyUp),this.off("focusout",this,this.handleFocusOut),this.$menuToggle&&this.off("click",this.$menuToggle,this.toggleMenu),this.$menuOverlay&&this.off("click",this.$menuOverlay,this.closeMenu)}animateIn(){i.from(this.$header,{y:-100,opacity:0,duration:.8,delay:.2,ease:"power2.out"})}handleScroll(){const e=window.scrollY;e>this.scrollThreshold&&!this.isScrolled?(this.isScrolled=!0,this.$header.classList.add("is-scrolled")):e<=this.scrollThreshold&&this.isScrolled&&(this.isScrolled=!1,this.$header.classList.remove("is-scrolled")),this.hideOnScroll&&(e>this.lastScrollY&&e>this.scrollThreshold?this.$header.classList.add("is-hidden"):this.$header.classList.remove("is-hidden")),this.lastScrollY=e}toggleMenu(){this.$header.classList.contains("menu-open")?this.closeMenu():this.openMenu()}openMenu(){var e;document.documentElement.style.setProperty("--viewport-height",`${window.innerHeight}px`),this.$header.classList.add("menu-open"),document.body.classList.add(`overflow-hidden-${this.breakpoint}`),this.$menuDrawer&&(this.$menuDrawer.classList.add("menu-opening"),i.fromTo(this.$menuDrawer,{x:"100%"},{x:"0%",duration:.5,ease:"power2.out",onComplete:()=>{o(this.$menuDrawer,this.$menuToggle)}})),this.$menuOverlay&&i.fromTo(this.$menuOverlay,{opacity:0},{opacity:1,duration:.3}),(e=this.$menuToggle)==null||e.setAttribute("aria-expanded","true"),this.emit("menu:open",document,{})}closeMenu(e=!0){var s;this.$menuDrawer?i.to(this.$menuDrawer,{x:"100%",duration:.4,ease:"power2.in",onComplete:()=>{this.$header.classList.remove("menu-open"),this.$menuDrawer.classList.remove("menu-opening"),document.body.classList.remove(`overflow-hidden-${this.breakpoint}`),this.closeAllSubmenus(),e&&n(this.$menuToggle)}}):(this.$header.classList.remove("menu-open"),document.body.classList.remove(`overflow-hidden-${this.breakpoint}`)),this.$menuOverlay&&i.to(this.$menuOverlay,{opacity:0,duration:.3}),(s=this.$menuToggle)==null||s.setAttribute("aria-expanded","false"),this.emit("menu:close",document,{})}handleSubmenuClick(e){const s=e.currentTarget,t=s.parentElement;t.hasAttribute("open")||setTimeout(()=>{t.classList.add("menu-opening"),s.setAttribute("aria-expanded","true");const l=t.querySelector("button, a");o(t.querySelector(".submenu")||t,l)},100)}handleCloseClick(e){const s=e.currentTarget.closest("details");s?this.closeSubmenu(s):this.closeMenu()}closeSubmenu(e){var s;e.classList.remove("menu-opening"),(s=e.querySelector("summary"))==null||s.setAttribute("aria-expanded","false"),setTimeout(()=>{e.removeAttribute("open"),n(e.querySelector("summary"))},300)}closeAllSubmenus(){this.$submenus.forEach(e=>{var s;e.removeAttribute("open"),e.classList.remove("menu-opening"),(s=e.querySelector("summary"))==null||s.setAttribute("aria-expanded","false")})}handleKeyUp(e){var t;if(e.code.toUpperCase()!=="ESCAPE")return;const s=e.target.closest("details[open]");if(s&&s!==((t=this.$menuDrawer)==null?void 0:t.closest("details"))){this.closeSubmenu(s);return}this.$header.classList.contains("menu-open")&&this.closeMenu()}handleFocusOut(){setTimeout(()=>{this.$header.classList.contains("menu-open")&&!this.contains(document.activeElement)&&this.closeMenu(!1)})}reset(){this.closeMenu(!1),this.closeAllSubmenus(),this.isScrolled=!1,this.lastScrollY=0}reveal(){this.$header.classList.remove("is-hidden")}}customElements.define("c-header",a);export{a as default};
//# sourceMappingURL=pieces-Header.js.map
