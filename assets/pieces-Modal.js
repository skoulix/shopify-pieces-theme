import{P as o}from"./pieces-Piece.js";import{g as i}from"./pieces-app.js";class a extends o{constructor(){super("Modal",{stylesheets:[]}),this.openedBy=null,this.focusableElements=[],this.firstFocusable=null,this.lastFocusable=null}mount(){var e,t;this.$closeButtons=this.$$("[data-modal-close]"),this.$dialog=this.$('[role="dialog"]')[0]||this,this.$overlay=this.$("[data-modal-overlay]")[0],this.$closeButtons.forEach(s=>{this.on("click",s,this.hide)}),this.$overlay&&this.on("click",this.$overlay,this.hide),this.on("keyup",this,this.onKeyUp),this.on("click",this,this.onBackdropClick),this.moved||(this.moved=!0,this.dataset.section=((t=(e=this.closest(".shopify-section"))==null?void 0:e.id)==null?void 0:t.replace("shopify-section-",""))||"",document.body.appendChild(this))}unmount(){this.$closeButtons.forEach(e=>{this.off("click",e,this.hide)}),this.$overlay&&this.off("click",this.$overlay,this.hide),this.off("keyup",this,this.onKeyUp),this.off("click",this,this.onBackdropClick)}show(e){this.openedBy=e;const t=this.$(".template-popup")[0];t!=null&&t.loadContent&&t.loadContent(),typeof pauseAllMedia=="function"&&pauseAllMedia(),document.body.classList.add("overflow-hidden"),this.setAttribute("open",""),i.fromTo(this,{opacity:0},{opacity:1,duration:.3,ease:"power2.out",onComplete:()=>{this.trapFocus()}}),this.$dialog&&this.$dialog!==this&&i.fromTo(this.$dialog,{scale:.95,opacity:0},{scale:1,opacity:1,duration:.3,ease:"power2.out"})}hide(){i.to(this,{opacity:0,duration:.2,ease:"power2.in",onComplete:()=>{document.body.classList.remove("overflow-hidden"),this.removeAttribute("open"),this.releaseFocus(),typeof pauseAllMedia=="function"&&pauseAllMedia(),document.body.dispatchEvent(new CustomEvent("modalClosed"))}})}onKeyUp(e){e.code==="Escape"&&this.hide()}onBackdropClick(e){e.target===this&&this.hide()}trapFocus(){var e;this.focusableElements=this.getFocusableElements(),this.firstFocusable=this.focusableElements[0],this.lastFocusable=this.focusableElements[this.focusableElements.length-1],(e=this.$dialog)==null||e.focus(),this.on("keydown",this,this.handleTabKey)}releaseFocus(){this.off("keydown",this,this.handleTabKey),this.openedBy&&this.openedBy.focus()}handleTabKey(e){var t,s;e.code==="Tab"&&(e.shiftKey?document.activeElement===this.firstFocusable&&(e.preventDefault(),(t=this.lastFocusable)==null||t.focus()):document.activeElement===this.lastFocusable&&(e.preventDefault(),(s=this.firstFocusable)==null||s.focus()))}getFocusableElements(){return Array.from(this.querySelectorAll('summary, a[href], button:enabled, [tabindex]:not([tabindex^="-"]), [draggable], area, input:not([type=hidden]):enabled, select:enabled, textarea:enabled, object, iframe'))}}customElements.define("c-modal",a);export{a as default};
//# sourceMappingURL=pieces-Modal.js.map
