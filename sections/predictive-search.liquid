{%- comment -%}
  Predictive Search Results - Tailwind Version
  Displays search suggestions, products, pages, and articles
{%- endcomment -%}

{% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
{%- if predictive_search.performed -%}
  {%- liquid
    assign first_column_results_size = predictive_search.resources.queries.size
      | plus: predictive_search.resources.collections.size
      | plus: predictive_search.resources.pages.size
      | plus: predictive_search.resources.articles.size
  -%}

  <div id="predictive-search-results" class="p-4" role="listbox">
    {%- if first_column_results_size > 0 or predictive_search.resources.products.size > 0 -%}
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {%- comment -%} Suggestions & Pages Column {%- endcomment -%}
        {%- if first_column_results_size > 0 -%}
          <div class="space-y-6">
            {%- comment -%} Suggestions {%- endcomment -%}
            {%- if predictive_search.resources.queries.size > 0 or predictive_search.resources.collections.size > 0 -%}
              <div>
                <h2 id="predictive-search-queries" class="text-xs font-medium uppercase tracking-wider text-neutral-500 mb-3">
                  {{ 'templates.search.suggestions' | t }}
                </h2>
                <ul
                  id="predictive-search-results-queries-list"
                  class="space-y-1"
                  role="group"
                  aria-labelledby="predictive-search-queries"
                >
                  {%- for query in predictive_search.resources.queries -%}
                    <li
                      id="predictive-search-option-query-{{ forloop.index }}"
                      class="predictive-search__list-item"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ query.url }}" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 transition-colors" tabindex="-1">
                        <p class="text-sm font-medium text-neutral-900" aria-label="{{ query.text }}">
                          {{ query.styled_text }}
                        </p>
                      </a>
                    </li>
                  {%- endfor -%}
                  {%- for collection in predictive_search.resources.collections -%}
                    <li
                      id="predictive-search-option-collection-{{ forloop.index }}"
                      class="predictive-search__list-item"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ collection.url }}" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 transition-colors" tabindex="-1">
                        <p class="text-sm font-medium text-neutral-900">{{ collection.title | escape }}</p>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}

            {%- comment -%} Pages & Articles (Desktop) {%- endcomment -%}
            {%- if predictive_search.resources.articles.size > 0 or predictive_search.resources.pages.size > 0 -%}
              <div class="hidden lg:block">
                <h2 id="predictive-search-pages-desktop" class="text-xs font-medium uppercase tracking-wider text-neutral-500 mb-3">
                  {{ 'templates.search.pages' | t }}
                </h2>
                <ul
                  id="predictive-search-results-pages-list-desktop"
                  class="space-y-1"
                  role="group"
                  aria-labelledby="predictive-search-pages-desktop"
                >
                  {%- for page in predictive_search.resources.pages -%}
                    <li
                      id="predictive-search-option-page-desktop-{{ forloop.index }}"
                      class="predictive-search__list-item"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ page.url }}" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 transition-colors" tabindex="-1">
                        <p class="text-sm font-medium text-neutral-900">{{ page.title | escape }}</p>
                      </a>
                    </li>
                  {%- endfor -%}
                  {%- for article in predictive_search.resources.articles -%}
                    <li
                      id="predictive-search-option-article-desktop-{{ forloop.index }}"
                      class="predictive-search__list-item"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ article.url }}" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 transition-colors" tabindex="-1">
                        <p class="text-sm font-medium text-neutral-900">{{ article.title | escape }}</p>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}

        {%- comment -%} Products Column {%- endcomment -%}
        {%- if predictive_search.resources.products.size > 0 or predictive_search.resources.articles.size > 0 or predictive_search.resources.pages.size > 0 -%}
          <div class="space-y-6">
            {%- if predictive_search.resources.products.size > 0 -%}
              <div>
                <h2 id="predictive-search-products" class="text-xs font-medium uppercase tracking-wider text-neutral-500 mb-3">
                  {{ 'templates.search.products' | t }}
                </h2>
                <ul
                  id="predictive-search-results-products-list"
                  class="space-y-2"
                  role="group"
                  aria-labelledby="predictive-search-products"
                >
                  {%- for product in predictive_search.resources.products -%}
                    <li
                      id="predictive-search-option-product-{{ forloop.index }}"
                      class="predictive-search__list-item"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ product.url }}" class="flex items-center gap-4 p-2 rounded-lg hover:bg-neutral-100 transition-colors" tabindex="-1">
                        {%- if product.featured_media != blank -%}
                          <div class="w-14 h-14 flex-shrink-0 bg-neutral-100 rounded-lg overflow-hidden">
                            <img
                              class="w-full h-full object-cover"
                              src="{{ product.featured_media | image_url: width: 150 }}"
                              alt="{{ product.featured_media.alt | escape }}"
                              width="56"
                              height="56"
                            >
                          </div>
                        {%- endif -%}
                        <div class="flex-1 min-w-0">
                          {%- if settings.predictive_search_show_vendor -%}
                            <p class="text-xs text-neutral-500 mb-0.5">{{ product.vendor }}</p>
                          {%- endif -%}
                          <p class="text-sm font-medium text-neutral-900 truncate">{{ product.title | escape }}</p>
                          {%- if settings.predictive_search_show_price -%}
                            <div class="mt-1">
                              {% render 'price', product: product, use_variant: true, show_badges: false %}
                            </div>
                          {%- endif -%}
                        </div>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}

            {%- comment -%} Pages & Articles (Mobile) {%- endcomment -%}
            {%- if predictive_search.resources.articles.size > 0 or predictive_search.resources.pages.size > 0 -%}
              <div class="lg:hidden">
                <h2 id="predictive-search-pages-mobile" class="text-xs font-medium uppercase tracking-wider text-neutral-500 mb-3">
                  {{ 'templates.search.pages' | t }}
                </h2>
                <ul
                  id="predictive-search-results-pages-list-mobile"
                  class="space-y-1"
                  role="group"
                  aria-labelledby="predictive-search-pages-mobile"
                >
                  {%- for page in predictive_search.resources.pages -%}
                    <li
                      id="predictive-search-option-page-mobile-{{ forloop.index }}"
                      class="predictive-search__list-item"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ page.url }}" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 transition-colors" tabindex="-1">
                        <p class="text-sm font-medium text-neutral-900">{{ page.title | escape }}</p>
                      </a>
                    </li>
                  {%- endfor -%}
                  {%- for article in predictive_search.resources.articles -%}
                    <li
                      id="predictive-search-option-article-mobile-{{ forloop.index }}"
                      class="predictive-search__list-item"
                      role="option"
                      aria-selected="false"
                    >
                      <a href="{{ article.url }}" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 transition-colors" tabindex="-1">
                        <p class="text-sm font-medium text-neutral-900">{{ article.title | escape }}</p>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- render 'loading-spinner', class: 'predictive-search__loading-state' -%}

    {%- comment -%} Search For Button {%- endcomment -%}
    <div id="predictive-search-option-search-keywords" class="mt-4 pt-4 border-t border-neutral-200">
      <button
        class="group flex items-center justify-between w-full px-3 py-2 text-left rounded-lg hover:bg-neutral-100 transition-colors"
        tabindex="-1"
        role="option"
        aria-selected="false"
      >
        <span class="text-sm font-medium text-neutral-900" data-predictive-search-search-for-text>
          {{ 'templates.search.search_for' | t: terms: predictive_search.terms }}
        </span>
        <span class="text-neutral-400 group-hover:text-neutral-600 group-hover:translate-x-0.5 transition-all">
          {%- render 'icon', name: 'arrow-right', size: '16' -%}
        </span>
      </button>
    </div>
  </div>

  <span class="hidden" data-predictive-search-live-region-count-value>
    {%- liquid
      assign total_results = predictive_search.resources.products.size | plus: first_column_results_size
      if total_results == 0
        echo 'templates.search.no_results' | t: terms: predictive_search.terms
      else
        echo 'templates.search.results_with_count' | t: count: total_results | append: ': '
        if predictive_search.resources.queries.size > 0
          assign count = predictive_search.resources.queries.size | plus: predictive_search.resources.collections.size
          echo 'templates.search.results_suggestions_with_count' | t: count: count | append: ', '
        endif
        if predictive_search.resources.pages.size > 0
          assign count = predictive_search.resources.pages.size | plus: predictive_search.resources.articles.size
          echo 'templates.search.results_pages_with_count' | t: count: count | append: ', '
        endif
        if predictive_search.resources.products.size > 0
          echo 'templates.search.results_products_with_count' | t: count: predictive_search.resources.products.size
        endif
      endif
    -%}
  </span>
{%- endif -%}
