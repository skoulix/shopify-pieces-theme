{%- comment -%}
  Main Article Section - Tailwind Version
  Full blog article page with comments
{%- endcomment -%}

<article class="py-12 lg:py-16">
  {%- for block in section.blocks -%}
    {%- case block.type -%}
      {%- when '@app' -%}
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8" {{ block.shopify_attributes }}>
          {% render block %}
        </div>

      {%- when 'featured_image' -%}
        {%- if article.image -%}
          <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 mb-8" {{ block.shopify_attributes }}>
            <div class="relative overflow-hidden rounded-xl bg-neutral-100
              {% case block.settings.image_height %}
                {% when 'small' %}aspect-[3/1]
                {% when 'medium' %}aspect-[2/1]
                {% when 'large' %}aspect-[16/9]
              {% endcase %}
            ">
              {{
                article.image
                | image_url: width: 1600
                | image_tag:
                  class: 'w-full h-full object-cover',
                  loading: 'eager',
                  fetchpriority: 'high',
                  widths: '400, 800, 1200, 1600'
              }}
            </div>
          </div>
        {%- endif -%}

      {%- when 'title' -%}
        <header class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 mb-8" {{ block.shopify_attributes }}>
          <h1 class="text-3xl lg:text-4xl font-semibold text-neutral-900 mb-4">
            {{ article.title | escape }}
          </h1>
          {%- if block.settings.blog_show_date or block.settings.blog_show_author -%}
            <div class="flex items-center gap-3 text-sm text-neutral-500">
              {%- if block.settings.blog_show_date -%}
                <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
                  {{ article.published_at | date: format: 'abbreviated_date' }}
                </time>
              {%- endif -%}
              {%- if block.settings.blog_show_date and block.settings.blog_show_author -%}
                <span>·</span>
              {%- endif -%}
              {%- if block.settings.blog_show_author -%}
                <span>{{ article.author }}</span>
              {%- endif -%}
            </div>
          {%- endif -%}
        </header>

      {%- when 'content' -%}
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 mb-12" {{ block.shopify_attributes }}>
          <div class="prose prose-neutral prose-lg max-w-none">
            {{ article.content }}
          </div>
        </div>

      {%- when 'share' -%}
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 mb-12" {{ block.shopify_attributes }}>
          {% assign share_url = request.origin | append: article.url %}
          {% render 'share-button', block: block, share_link: share_url %}
        </div>
    {%- endcase -%}
  {%- endfor -%}

  {%- comment -%} Back to Blog Link {%- endcomment -%}
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 mb-12">
    <a href="{{ blog.url }}" class="inline-flex items-center gap-2 text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors">
      {%- render 'icon', name: 'arrow-left', size: '16' -%}
      {{ 'blogs.article.back_to_blog' | t: title: blog.title | escape }}
    </a>
  </div>

  {%- comment -%} Comments Section {%- endcomment -%}
  {%- if blog.comments_enabled? -%}
    <div class="bg-neutral-50 py-12">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8" id="comments">
        {%- if article.comments_count > 0 -%}
          <h2 class="text-xl font-semibold text-neutral-900 mb-6" id="Comments-{{ article.id }}" tabindex="-1">
            {{ 'blogs.article.comments' | t: count: article.comments_count }}
          </h2>

          {% paginate article.comments by 5 %}
            <div class="space-y-6 mb-12">
              {%- if comment.status == 'pending' and comment.content -%}
                <div class="bg-white p-6 rounded-xl border border-neutral-200">
                  <div class="prose prose-sm prose-neutral max-w-none mb-4">
                    {{ comment.content }}
                  </div>
                  <p class="text-sm text-neutral-500">{{ comment.author }}</p>
                </div>
              {%- endif -%}

              {%- for comment in article.comments -%}
                <div id="{{ comment.id }}" class="bg-white p-6 rounded-xl border border-neutral-200">
                  <div class="prose prose-sm prose-neutral max-w-none mb-4">
                    {{ comment.content }}
                  </div>
                  <div class="flex items-center gap-3 text-sm text-neutral-500">
                    <span>{{ comment.author }}</span>
                    <span>·</span>
                    <time datetime="{{ comment.created_at | date: '%Y-%m-%d' }}">
                      {{ comment.created_at | date: format: 'abbreviated_date' }}
                    </time>
                  </div>
                </div>
              {%- endfor -%}
            </div>

            {%- assign anchorId = '#Comments-' | append: article.id -%}
            {% render 'pagination', paginate: paginate, anchor: anchorId %}
          {% endpaginate %}
        {%- endif -%}

        {%- comment -%} Comment Form {%- endcomment -%}
        {% form 'new_comment', article %}
          {%- liquid
            assign post_message = 'blogs.article.success'
            if blog.moderated? and comment.status == 'unapproved'
              assign post_message = 'blogs.article.success_moderated'
            endif
          -%}

          <h2 class="text-xl font-semibold text-neutral-900 mb-6">
            {{ 'blogs.article.comment_form_title' | t }}
          </h2>

          {%- if form.errors -%}
            <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg" role="alert">
              <p class="flex items-center gap-2 text-red-800 font-medium mb-2">
                {%- render 'icon', name: 'warning', size: '20' -%}
                {{ 'templates.contact.form.error_heading' | t }}
              </p>
              <ul class="list-disc list-inside text-sm text-red-700">
                {%- for field in form.errors -%}
                  <li>
                    {%- if form.errors.translated_fields[field] contains 'author' -%}
                      {{ 'blogs.article.name' | t }}
                    {%- elsif form.errors.translated_fields[field] contains 'body' -%}
                      {{ 'blogs.article.message' | t }}
                    {%- else -%}
                      {{ form.errors.translated_fields[field] }}
                    {%- endif -%}
                    {{ form.errors.messages[field] }}
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- elsif form.posted_successfully? -%}
            <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg" role="status" tabindex="-1" autofocus>
              <p class="flex items-center gap-2 text-green-800">
                {%- render 'icon', name: 'check-circle', size: '20' -%}
                {{ post_message | t }}
              </p>
            </div>
          {%- endif -%}

          <div class="space-y-5">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
              <div>
                <label for="CommentForm-author" class="block text-sm font-medium text-neutral-700 mb-1.5">
                  {{ 'blogs.article.name' | t }} <span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  name="comment[author]"
                  id="CommentForm-author"
                  autocomplete="name"
                  value="{{ form.author }}"
                  aria-required="true"
                  required
                  {% if form.errors contains 'author' %}aria-invalid="true"{% endif %}
                  class="w-full h-12 px-4 bg-white border border-neutral-300 rounded-lg text-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent transition-shadow"
                  placeholder="{{ 'blogs.article.name' | t }}"
                >
              </div>

              <div>
                <label for="CommentForm-email" class="block text-sm font-medium text-neutral-700 mb-1.5">
                  {{ 'blogs.article.email' | t }} <span class="text-red-500">*</span>
                </label>
                <input
                  type="email"
                  name="comment[email]"
                  id="CommentForm-email"
                  autocomplete="email"
                  value="{{ form.email }}"
                  autocorrect="off"
                  autocapitalize="off"
                  aria-required="true"
                  required
                  {% if form.errors contains 'email' %}aria-invalid="true"{% endif %}
                  class="w-full h-12 px-4 bg-white border border-neutral-300 rounded-lg text-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent transition-shadow"
                  placeholder="{{ 'blogs.article.email' | t }}"
                >
              </div>
            </div>

            <div>
              <label for="CommentForm-body" class="block text-sm font-medium text-neutral-700 mb-1.5">
                {{ 'blogs.article.message' | t }} <span class="text-red-500">*</span>
              </label>
              <textarea
                rows="5"
                name="comment[body]"
                id="CommentForm-body"
                aria-required="true"
                required
                {% if form.errors contains 'body' %}aria-invalid="true"{% endif %}
                class="w-full px-4 py-3 bg-white border border-neutral-300 rounded-lg text-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent transition-shadow resize-y"
                placeholder="{{ 'blogs.article.message' | t }}"
              >{{ form.body }}</textarea>
            </div>

            {%- if blog.moderated? -%}
              <p class="text-sm text-neutral-500">{{ 'blogs.article.moderated' | t }}</p>
            {%- endif -%}

            <button
              type="submit"
              class="h-12 px-6 bg-neutral-900 text-white text-sm font-medium rounded-lg hover:bg-neutral-800 transition-colors"
            >
              {{ 'blogs.article.post' | t }}
            </button>
          </div>
        {% endform %}
      </div>
    </div>
  {%- endif -%}
</article>

<script type="application/ld+json">
  {{ article | structured_data }}
</script>

{% schema %}
{
  "name": "t:sections.main-article.name",
  "tag": "section",
  "class": "section",
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "featured_image",
      "name": "t:sections.main-article.blocks.featured_image.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "image_height",
          "options": [
            {
              "value": "adapt",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__1.label"
            },
            {
              "value": "small",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__2.label"
            },
            {
              "value": "medium",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__3.label"
            },
            {
              "value": "large",
              "label": "t:sections.main-article.blocks.featured_image.settings.image_height.options__4.label"
            }
          ],
          "default": "adapt",
          "label": "t:sections.main-article.blocks.featured_image.settings.image_height.label"
        }
      ]
    },
    {
      "type": "title",
      "name": "t:sections.main-article.blocks.title.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "blog_show_date",
          "default": true,
          "label": "t:sections.main-article.blocks.title.settings.blog_show_date.label"
        },
        {
          "type": "checkbox",
          "id": "blog_show_author",
          "default": false,
          "label": "t:sections.main-article.blocks.title.settings.blog_show_author.label"
        }
      ]
    },
    {
      "type": "content",
      "name": "t:sections.main-article.blocks.content.name",
      "limit": 1
    },
    {
      "type": "share",
      "name": "t:sections.main-article.blocks.share.name",
      "limit": 2,
      "settings": [
        {
          "type": "text",
          "id": "share_label",
          "label": "t:sections.main-article.blocks.share.settings.text.label",
          "default": "t:sections.main-article.blocks.share.settings.text.default"
        }
      ]
    }
  ]
}
{% endschema %}
