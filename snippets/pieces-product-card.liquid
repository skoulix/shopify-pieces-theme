{%- comment -%}
  Pieces Product Card Component - Tailwind Edition

  A clean, Tailwind-based product card that uses Shopify theme settings
  for colors, typography, and spacing. No external CSS required.

  Usage:
  {% render 'pieces-product-card',
    product: product,
    show_secondary_image: true,
    show_quick_add: true,
    show_vendor: false,
    aspect_ratio: 'portrait',
    reveal_animation: 'fade-up',
    reveal_delay: 0
  %}

  Aspect ratios: 'square', 'portrait' (4:5), 'landscape' (16:9), 'natural'
{%- endcomment -%}

{%- liquid
  assign reveal_animation = reveal_animation | default: 'fade-up'
  assign reveal_delay = reveal_delay | default: 0
  assign show_secondary_image = show_secondary_image | default: true
  assign show_quick_add = show_quick_add | default: true
  assign show_vendor = show_vendor | default: false
  assign aspect_ratio = aspect_ratio | default: 'portrait'

  assign first_variant = product.selected_or_first_available_variant
  assign has_secondary_image = false
  if product.media.size > 1 and show_secondary_image
    assign has_secondary_image = true
  endif

  case aspect_ratio
    when 'square'
      assign aspect_class = 'aspect-square'
    when 'portrait'
      assign aspect_class = 'aspect-[4/5]'
    when 'landscape'
      assign aspect_class = 'aspect-video'
    when 'natural'
      assign aspect_class = ''
  endcase

  assign is_on_sale = false
  if product.compare_at_price > product.price
    assign is_on_sale = true
  endif
-%}

<c-product-card
  class="card-wrapper group"
  data-reveal="{{ reveal_animation }}"
  data-reveal-delay="{{ reveal_delay }}"
>
  {%- comment -%} Card Container - uses theme border radius & shadow {%- endcomment -%}
  <div class="card relative flex flex-col h-full bg-background">

    {%- comment -%} Image Container {%- endcomment -%}
    <a href="{{ product.url }}" class="card-media {{ aspect_class }} block">
      {%- if product.featured_media -%}
        {%- comment -%} Primary Image {%- endcomment -%}
        {{ product.featured_media | image_url: width: 800 | image_tag:
          class: 'w-full h-full object-cover transition-transform duration-700 ease-out-expo group-hover:scale-[1.03]',
          loading: 'lazy',
          widths: '400, 600, 800, 1200',
          sizes: '(min-width: 1200px) 25vw, (min-width: 990px) 33vw, (min-width: 750px) 50vw, 100vw'
        }}

        {%- comment -%} Secondary Image (on hover) {%- endcomment -%}
        {%- if has_secondary_image -%}
          <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 ease-out-expo">
            {{ product.media[1] | image_url: width: 800 | image_tag:
              class: 'w-full h-full object-cover',
              loading: 'lazy',
              widths: '400, 600, 800, 1200',
              sizes: '(min-width: 1200px) 25vw, (min-width: 990px) 33vw, (min-width: 750px) 50vw, 100vw'
            }}
          </div>
        {%- endif -%}
      {%- else -%}
        <div class="w-full h-full bg-foreground/5 flex items-center justify-center">
          {{ 'product-1' | placeholder_svg_tag: 'w-1/2 h-1/2 text-foreground/20' }}
        </div>
      {%- endif -%}

      {%- comment -%} Badge - positioned based on theme settings {%- endcomment -%}
      <div class="absolute top-3 left-3 flex flex-col gap-2">
        {%- if is_on_sale and first_variant.available -%}
          <span class="badge badge-sale color-{{ settings.sale_badge_color_scheme }}">
            {{ 'products.product.on_sale' | t }}
          </span>
        {%- endif -%}

        {%- unless first_variant.available -%}
          <span class="badge badge-sold-out color-{{ settings.sold_out_badge_color_scheme }}">
            {{ 'products.product.sold_out' | t }}
          </span>
        {%- endunless -%}
      </div>

      {%- comment -%} Quick Add Button {%- endcomment -%}
      {%- if show_quick_add and first_variant.available -%}
        <div class="absolute inset-x-4 bottom-4 opacity-0 translate-y-2 group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300 ease-out-expo">
          <button
            type="button"
            data-quick-add
            data-variant-id="{{ first_variant.id }}"
            data-quantity="1"
            class="btn-primary btn-full text-sm"
            aria-label="{{ 'products.product.add_to_cart' | t }}: {{ product.title }}"
          >
            <span data-quick-add-text>{{ 'products.product.add_to_cart' | t }}</span>
            <span data-quick-add-loading class="hidden">
              <span class="loading-spinner"></span>
            </span>
            <span data-quick-add-added class="hidden">{{ 'products.product.added' | t | default: 'Added' }}</span>
          </button>
        </div>
      {%- endif -%}
    </a>

    {%- comment -%} Product Info {%- endcomment -%}
    <div class="card-content text-[var(--product-card-text-alignment)]">
      {%- if show_vendor and product.vendor != blank -%}
        <p class="text-xs text-foreground/60 uppercase tracking-wider mb-1">
          {{ product.vendor }}
        </p>
      {%- endif -%}

      <h3 class="card-title text-sm md:text-base">
        <a href="{{ product.url }}" class="full-unstyled-link hover:underline underline-offset-4">
          {{ product.title }}
        </a>
      </h3>

      {%- comment -%} Price {%- endcomment -%}
      <div class="price mt-2 text-sm">
        {%- if is_on_sale -%}
          <span class="price-sale">{{ product.price | money }}</span>
          <span class="price-compare">{{ product.compare_at_price | money }}</span>
        {%- else -%}
          <span class="price-regular">{{ product.price | money }}</span>
        {%- endif -%}

        {%- if product.price_varies -%}
          <span class="text-foreground/60 text-xs">{{ 'products.product.price.from_price_html' | t: price: '' }}</span>
        {%- endif -%}
      </div>

      {%- comment -%} Unit price (if available) {%- endcomment -%}
      {%- if first_variant.unit_price_measurement -%}
        <div class="text-xs text-foreground/60 mt-1">
          {{ first_variant.unit_price | money }}/{{ first_variant.unit_price_measurement.reference_unit }}
        </div>
      {%- endif -%}
    </div>
  </div>
</c-product-card>
